### 场景一：连续插入 10 条数据后，分别用 `DELETE` 和 `TRUNCATE` 删除，再插入 1 条数据

#### 前提说明

MySQL 5.7 中，**InnoDB 引擎的自增主键计数器（auto-increment counter）默认存储在「内存中」**，同时会将当前自增最大值记录在「表结构文件（.ibd）」中（用于重启后的部分恢复），先明确两个操作的核心差异：

|                      操作类型                      |                      对自增计数器的影响                      | 再插入 1 条数据的主键 ID |
| :------------------------------------------------: | :----------------------------------------------------------: | :----------------------: |
| `DELETE FROM 表名;`（无 WHERE 条件，删除所有数据） | 仅删除表中的数据行，**不会重置自增计数器**，自增计数器仍保留在「11」（插入 10 条后，下一个自增值为 11） |        从 11 开始        |
|      `TRUNCATE TABLE 表名;`（清空表所有数据）      | 不仅删除所有数据行，还会「重置自增计数器」（恢复为该表的初始自增值，默认是 1），同时会重建表结构（比 `DELETE` 更高效） |        从 1 开始         |

#### 详细解析

1. `DELETE` 操作的本质：`DELETE` 是「DML（数据操作语言）」，操作仅针对表中的数据行，不会修改表的元数据（包括自增计数器、表结构定义等）。连续插入 10 条数据后，自增计数器已经累计到 11（下一个待分配的 ID），`DELETE` 删除所有数据后，这个计数器值在内存中保持不变，因此再插入数据时，会直接分配 11 作为主键 ID。
2. `TRUNCATE` 操作的本质：`TRUNCATE` 是「DDL（数据定义语言）」，其执行逻辑是「销毁原表，重建一张结构完全相同的空表」。重建表的过程中，自增计数器会被重置为默认初始值（1，若表创建时指定 `AUTO_INCREMENT = n`，则重置为 n），因此再插入数据时，主键 ID 从 1 开始。

### 场景二：`DELETE` 删除 10 条数据后，重启 MySQL 服务，再插入 1 条数据

#### 核心结论

**这条数据的主键 ID 从 1 开始（而非 11）**（默认场景下，无特殊配置）。

#### 详细解析

1. 先明确关键知识点：MySQL 5.7 中 InnoDB 引擎的自增计数器「存储特性」

   - 运行时：自增计数器存储在「内存中」，不会持久化到磁盘的二进制日志或配置文件中，`DELETE` 操作后计数器保持在 11，但该值仅存在于当前 MySQL 服务进程的内存中。
   - 重启后：MySQL 服务重启时，会销毁所有内存中的数据（包括自增计数器的当前值 11），此时 InnoDB 会通过「扫描表的 `.ibd` 数据文件」，获取表中「已存在的最大主键 ID」，然后将自增计数器设置为「最大主键 ID + 1」。

   

2. 具体流程拆解

   - 步骤 1：连续插入 10 条数据，主键 ID 为 1~10，自增计数器内存中值为 11；
   - 步骤 2：`DELETE` 删除所有数据，表中无任何数据行，自增计数器内存中仍为 11，但 `.ibd` 文件中无有效主键数据（所有数据行已被删除）；
   - 步骤 3：重启 MySQL 服务，内存中的自增计数器 11 被销毁；
   - 步骤 4：MySQL 扫描该表的 `.ibd` 文件，发现表中无有效数据，最大主键 ID 为「不存在」（视为 0）；
   - 步骤 5：自增计数器被设置为「0 + 1 = 1」，因此再插入 1 条数据时，主键 ID 从 1 开始。

   

#### 补充：特殊情况（若 `DELETE` 未删除所有数据）

若 `DELETE` 仅删除部分数据（如删除 ID1~9，保留 ID10），重启 MySQL 服务后，扫描 `.ibd` 文件会发现最大主键 ID 为 10，自增计数器会被设置为 11，此时再插入数据，主键 ID 从 11 开始。

### 额外补充：影响自增主键的关键配置（MySQL 5.7）

1. `innodb_autoinc_lock_mode`：控制自增主键的分配模式（默认值为 1），仅影响并发插入时的 ID 分配，不影响 `DELETE`/`TRUNCATE`/ 重启后的计数器重置逻辑。
2. 表创建时指定 `AUTO_INCREMENT`：若创建表时语句为 `CREATE TABLE 表名 (id INT PRIMARY KEY AUTO_INCREMENT = 5);`，则 `TRUNCATE` 后自增计数器重置为 5，重启后若表无数据，自增计数器也会设置为 5。

### 总结

1. `DELETE` 删全表：不重置自增计数器，再插入 ID 从 11 开始；
2. `TRUNCATE` 删全表：重置自增计数器，再插入 ID 从 1 开始；
3. `DELETE` 删全表 + 重启 MySQL：自增计数器从内存销毁，扫描无数据后重置为 1，再插入 ID 从 1 开始；
4. 核心差异：`DELETE`（DML）不修改元数据，`TRUNCATE`（DDL）重建表重置元数据，自增计数器内存存储特性决定重启后的行为。
